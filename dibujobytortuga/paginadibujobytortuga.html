<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="dibujobytortuga.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Este código hace un párrafo 
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Tortuga</title>
    <style>
        #canvas {
            position: absolute; 
            left: 360px; 
            top: 150px;
            border: 1px solid #000;
        }

        #botonejecutar{
            position: absolute; 
            left: 100px; 
            top: 700px;
        }

    </style>
</head>
<body style="margin-right:21% ; margin-top:11%; display:flex;align-items: center">
    
    <canvas id="canvas" width="1200" height="670"></canvas>
    
    <br>
    <label for="instrucciones">Instrucciones:</label>
    <input type="text" id="instrucciones" placeholder="Avanzar 50, Girar 90, ..." />
    <button botonejecutar onclick="ejecutarInstrucciones()">Ejecutar</button>
    <button onclick="dibujarTortuga()">Crear tortuga</button>

    <div>
        <a href="../pagina_juegos/paginajuegos.html" title="Librería de juegos">
            <button class="buttonBack-layout" tittle="Librería de juegos">Back</button>
        </a>
    </div>

    <div id="phaser-container">
        <script>
            // Código en JavaScript
        // Obtener el lienzo y su contexto
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Objeto Tortuga para mantener el estado
        const tortuga = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            angulo: 0 // Ángulo en grados
        };

        function ejecutarInstrucciones() {
            const instruccionesInput = document.getElementById('instrucciones');
            const instrucciones = instruccionesInput.value.split(',');

            instrucciones.forEach(instruccion => {
                const dividir = instruccion.trim().split(' ');
                const comando = dividir[0].toLowerCase();
                const valor = parseInt(dividir[1]);

                switch (comando) {
                    case 'avanzar':
                        moverTortuga(valor);
                        break;
                    case 'girar':
                        girarTortuga(valor);
                        break;  
                    default:
                        console.log('Instrucción no reconocida:', instruccion);
                }
            });
            dibujarTortuga();
        }
        // Función para dibujar la tortuga en el canvas
        function dibujarTortuga() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dibujar el rectángulo para representar la tortuga
            const anchoTortuga = 20;
            const altoTortuga = 15;

            ctx.save();
            ctx.translate(tortuga.x, tortuga.y);
            ctx.rotate(tortuga.angulo * (Math.PI / 180)); // Rotar según el ángulo

            ctx.fillStyle = 'green';
            ctx.fillRect(-anchoTortuga / 2, -altoTortuga / 2, anchoTortuga, altoTortuga);
            ctx.strokeRect(-anchoTortuga / 2, -altoTortuga / 2, anchoTortuga, altoTortuga);

            ctx.restore();
        }

        // Función para girar la tortuga suavemente
        function girarTortuga(grados) {
            // Número de pasos para suavizar el giro
            const pasosgiro = 20;
            const duracion = 500;
            const stepAngle = grados / pasosgiro;
            const intervalo = duracion / pasosgiro;

            // Animación de giro suave
            let step = 0;
            const turnos = setInterval(() => {
                tortuga.angulo += stepAngle;
                dibujarTortuga();
                step++;
                if (step === pasosgiro) {
                    clearInterval(turnos);
                }
            }, intervalo);
        }

        // Función para desplazar la tortuga suavemente
        function moverTortuga(distancia) {
            const radianes = tortuga.angulo * (Math.PI / 180);
            const deltaX = distancia * Math.cos(radianes);
            const deltaY = distancia * Math.sin(radianes);
            const pasos = 20;
            const duracion = 500;
            const interval = duracion / pasos;

            // Animación de movimiento suave
            let pasos_const = 0;
            const smoothMove = setInterval(() => {
                // Actualizar las coordenadas de la tortuga
                const ultimaPosicionTortuga = { x: tortuga.x, y: tortuga.y };
                tortuga.x += deltaX / pasos;
                tortuga.y += deltaY / pasos;

                // Dibujar la tortuga y agregar la posición al rastro
                dibujarTortuga();
                rastroTortuga(distancia);

                pasos_const++;
                // Comprobar todos los pasos
                if (pasos_const === pasos) {
                    clearInterval(smoothMove);
                }
            }, interval);
        }


        // Variable para almacenar el rastro acumulado
        const rastroAcumulado = [];

        // Modifica la función para desplazar la tortuga y dibujar el rastro
        function rastroTortuga(distancia) {
            const radianes = tortuga.angulo * (Math.PI / 180);

            // Almacena la posición actual antes de actualizarla
            const ultimaPosicionTortuga = { x: tortuga.x, y: tortuga.y };

            // Actualiza las coordenadas de la tortuga
            tortuga.x += distancia * Math.cos(radianes);
            tortuga.y += distancia * Math.sin(radianes);

            // Agrega la posición al rastro acumulado
            rastroAcumulado.push({ inicio: ultimaPosicionTortuga, fin: { x: tortuga.x, y: tortuga.y } });

            // Dibuja todo el rastro acumulado
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            dibujarTortuga(); // Dibuja la tortuga en su posición actual

            rastroAcumulado.forEach(({ inicio, fin }) => {
                ctx.beginPath();
                ctx.moveTo(inicio.x, inicio.y);
                ctx.lineTo(fin.x, fin.y);
                ctx.strokeStyle = 'black';
                ctx.stroke();
            });
            
        }


        </script>
        </div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="rescatedelgatito.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <script src="./package/blockly_compressed.js"></script>
    <script src="./package/blocks_compressed.js"></script>
    <script src="./package/javascript_compressed.js"></script>
    <script src="./package/msg/es.js"></script>
    
    
</head>
<body style="margin-right:22% ; margin-top:9%; display:flex;align-items: center">
    <xml id="toolbox" style="display: none">
        <block type="move_left"></block>
      </xml>
    <div>
        <a href="../pagina_juegos/paginajuegos.html">
            <button class="buttonBack-layout" title="Librería de juegos">Back</button>
        </a>
    </div>

    <div id="phaser-container">
       
    <script>
    
    var gato;
     var jugador;
     let cursors;
     var estado = 'idle';
     let direccion = 0; // 0 = quieto, -1 = izquierda, 1 = derecha
     let tiempoMovimiento = null;
     let acciones;
     class Example extends Phaser.Scene
{
    preload ()
    {
        this.load.image('sky', './fondo-abstracto-azul-degradado-estudio-azul-oscuro-liso-vineta-negra_1258-67766.webp');
        this.load.image('gato', 'gato.png');
        this.load.image('plataforma', 'plataforma.png');
        this.load.image('red', 'assets/particles/red.png');
        this.load.image('jugador', 'jugador.png');
        this.load.image('nubes', 'nubes.png');
        this.load.image('saltar', 'saltar.png');
        this.load.image('saltarderecha', 'saltar derecha.png');
        this.load.image('saltarizquierda', 'saltar izquierda.png');
    }

    create ()
    {   
        let fondo = this.add.image(600, 300, 'sky');
        fondo.displayWidth = 2000;
        fondo.displayHeight = 2000;


        gato = this.physics.add.sprite (810,300,'gato')
        gato.setScale(0.23)
        gato.body.setSize(250, 300);
        gato.setInteractive
  
        

        let plataforma1 = this.physics.add.sprite (820,400,'plataforma')
        plataforma1.setScale(0.27)
        plataforma1.body.setAllowGravity(false);
        plataforma1.body.setImmovable(true);
        plataforma1.body.setSize(400, 230);
        plataforma1.body.setOffset(120, 100);
    

        jugador = this.physics.add.sprite (40,100,'jugador')
        jugador.body.setSize(40, 80);
        jugador.body.setOffset(20, 10); // mueve la hitbox respecto al sprite 

        cursors = this.input.keyboard.createCursorKeys();
        var plataformas= this.physics.add.group();
        plataformas.createMultiple({
            key: 'plataforma',
            repeat: 5,
            setXY: {x:40,y:400,stepX: 200,stepY:0 },
        });

        plataformas.children.iterate(function(child) {
            child.setScale(0.27, 0.27);
            child.body.setAllowGravity(false);
            child.body.setImmovable(true);
            child.body.setSize(380, 230);
            child.body.setOffset(130, 100);
            
        });

        
        let saltar1= this.add.sprite(370,28,'saltar');
        saltar1.visible=false;
        let saltar2= this.add.sprite(370,28,'saltar');
        saltar2.visible=false;
        let saltar3= this.add.sprite(370,28,'saltar');
        saltar3.visible=false;
        let saltar4= this.add.sprite(370,28,'saltar');
        saltar4.visible=false;
        let saltar5= this.add.sprite(370,28,'saltar');
        saltar5.visible=false;
        let saltar6= this.add.sprite(370,28,'saltar');
        saltar6.visible=false;
        let saltar7= this.add.sprite(370,28,'saltar');
        saltar7.visible=false;
        let saltar8= this.add.sprite(370,28,'saltar');
        saltar8.visible=false;
        let saltar9= this.add.sprite(370,28,'saltar');
        saltar9.visible=false;
        let saltar10= this.add.sprite(370,28,'saltar');
        saltar10.visible=false;

        let instrucciones = [];
        
        let boton1= this.add.sprite(370,28,'saltar');
        var pos=50;
        boton1.setScale(0.7);
        boton1.setInteractive();
        boton1.on('pointerdown', () => {
                instrucciones.push("Saltar");
            boton1.setPosition(
                pos+150,
                570
            );
            pos=pos+150;
                console.log('¡Botón presionado!');
                //se imprimen las instrucciones para saber si se estan agreagando al arraylist
                for(let i = 0; i < instrucciones.length; i++) {
                console.log(instrucciones[i]);
}
            });

        let boton2= this.add.sprite(235,30,'saltarderecha');
        boton2.setScale(0.7);
        boton2.setInteractive();
        boton2.on('pointerdown', () => {
                instrucciones.push("Saltar Derecha");
            boton2.setPosition(
                pos+150,
                570
            );
            pos=pos+150;
                console.log('¡Botón presionado!');
                //se imprimen las instrucciones para saber si se estan agreagando al arraylist
                for(let i = 0; i < instrucciones.length; i++) {
                console.log(instrucciones[i]);
}
            });    
        let boton3= this.add.sprite(95,30,'saltarizquierda');
        boton3.setScale(0.7);
        boton3.setInteractive();
        boton3.on('pointerdown', () => {
                instrucciones.push("Saltar izquierda");
                boton3.setPosition(
                pos+150,
                570
            );
            pos=pos+150;
                console.log('¡Botón presionado!');
                //se imprimen las instrucciones para saber si se estan agreagando al arraylist
                for(let i = 0; i < instrucciones.length; i++) {
                console.log(instrucciones[i]);
}
            });                

       

        this.physics.add.collider(jugador, plataformas);
        this.physics.add.collider(jugador, plataforma1);
        this.physics.add.collider(gato, plataforma1); 
       // this.physics.add.overlap(jugador, gato, this.victory, null, this);

        let botonEjecutar = this.add.sprite(500, 30, 'botonEjecutar');
        botonEjecutar.setInteractive();
       
                // Define las acciones y sus tiempos de espera
        acciones = {
            "Saltar": {funcion: () => jugador.setVelocityY(-800), tiempo: 1000},
            "Saltar Derecha": {funcion: () => {jugador.setVelocityX(200); jugador.setVelocityY(-800); direccion = 1; tiempoMovimiento = Date.now();}, tiempo: 1000},
            "Saltar Izquierda": {funcion: () => {jugador.setVelocityX(-200); jugador.setVelocityY(-800); direccion = -1; tiempoMovimiento = Date.now();}, tiempo: 1000}
        };

        botonEjecutar.on('pointerdown', () => {
            botonEjecutar.setVisible(false); // Hace desaparecer el botón
            let tiempoTotal = 0;
            for(let i = 0; i < instrucciones.length; i++) {
                tiempoTotal += acciones[instrucciones[i]].tiempo;
                setTimeout(() => {
                    if(acciones[instrucciones[i]]) {
                        acciones[instrucciones[i]].funcion();
                    }
                }, tiempoTotal);
            }
            // Vacía el array de instrucciones después de programarlas todas y hace reaparecer el botón
            setTimeout(() => {instrucciones = []; botonEjecutar.setVisible(true);}, tiempoTotal);
        });
      

    // Modifica este bloque para agregar una acción al hacer clic en cada sprite
    acciones.forEach(function (instrucciones) {
        acciones.setInteractive();

        acciones.on('pointerdown', function () {
            // Mueve el elemento a una nueva posición aleatoria
            acciones.setPosition(
                Phaser.Math.Between(0, this.sys.game.config.width),
                Phaser.Math.Between(0, this.sys.game.config.height)
            );

            console.log('Hiciste clic en el elemento: ' + elemento.texture.key);
        }, this);
    });

        
    }

    update()  {
    /*if (cursors.left.isDown){
        jugador.setVelocityX(-200);
        jugador.setFlipX(true);
        estado = 'moviendose';
    } else if(cursors.right.isDown){
        jugador.setVelocityX(200);
        jugador.setFlipX(false); 
        estado = 'moviendose';
    } else {
        jugador.setVelocityX(0);
        estado = 'quieto';
    }
    if (cursors.up.isDown && jugador.body.touching.down){
        jugador.setVelocityY(-800);
        estado = 'saltando';
    }

   */

   if (direccion === 1 && !jugador.body.touching.down) {
        jugador.setVelocityX(200);
    } 
    if (jugador.body.touching.down) {
        if (direccion === 1) {
            jugador.setVelocityX(0); // Restablece la velocidad en el eje X
        }
        direccion = 0; // Restablece la dirección cuando el jugador toca el suelo
    }
    if(jugador.y > 1000 || jugador.x<0 || jugador.x>1000){
        this.physics.pause();
        this.gameOver();
    }

    }

    gameOver(){
    this.physics.pause();
    let gameOver = this.add.text(500, 300, 'Game Over', { fontSize: '32px', fill: '#FF0000' });
    gameOver.setOrigin(0.5);

    // Detén el juego o haz lo que necesites hacer cuando el juego termine
    console.log("¡Game Over!");
    let botony=400;
    let botonReinicio = this.add.rectangle(500, botony, 150, 50, 0xFFFFFF).setInteractive();
    let textoBoton = this.add.text(500, botony, 'Reiniciar', { fontSize: '20px', fill: '#000000' }).setOrigin(0.5);

    botonReinicio.on('pointerdown', () => this.reiniciarJuego());
  

    }

    victory(){
    this.physics.pause();
    let victoria = this.add.text(500, 300, '¡Victoria!', { fontSize: '32px', fill: '#00FF00' });
    victoria.setOrigin(0.5);

    console.log("¡Victoria!");
    let botony=400;
    let botonReinicio = this.add.rectangle(500, botony, 150, 50, 0xFFFFFF).setInteractive();
    let textoBoton = this.add.text(500, botony, 'Reiniciar', { fontSize: '20px', fill: '#000000' }).setOrigin(0.5);

    botonReinicio.on('pointerdown', () => this.reiniciarJuego());
    }

    reiniciarJuego() {
    // Código para reiniciar el juego
    this.scene.restart();
    }

    
}

const config = {
    type: Phaser.AUTO,
    width: 1050,
    height: 600,
   
    scene: Example,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 1500 },
            debug: true
        }
    }
};



const game = new Phaser.Game(config);
  




        

    </script>

 </div>


   
    
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="rescatedelgatito.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    

</head>
<body style="margin-right:22% ; margin-top:9%; display:flex;align-items: center">

    <div>
        <a href="../pagina_juegos/paginajuegos.html">
            <button class="buttonBack-layout" title="Librería de juegos">Back</button>
        </a>
    </div>
    <div id="phaser-container">
    <script>

    var gato;
     var jugador;
     let cursors;
     var estado = 'idle';

     class Example extends Phaser.Scene
{
    preload ()
    {
        this.load.image('sky', './fondo-abstracto-azul-degradado-estudio-azul-oscuro-liso-vineta-negra_1258-67766.webp');
        this.load.image('gato', 'gato.png');
        this.load.image('plataforma', 'plataforma.png');
        this.load.image('red', 'assets/particles/red.png');
        this.load.image('jugador', 'jugador.png');
        this.load.image('nubes', 'nubes.png');
        this.load.image('saltar', 'saltar.png');
        this.load.image('saltarderecha', 'saltar derecha.png');
        this.load.image('saltarizquierda', 'saltar izquierda.png');
    }

    create ()
    {   
        let fondo = this.add.image(600, 300, 'sky');
        fondo.displayWidth = 2000;
        fondo.displayHeight = 2000;

        gato = this.physics.add.sprite (810,300,'gato')
        gato.setScale(0.23)
        gato.body.setSize(250, 300);
  
        

        let plataforma1 = this.physics.add.sprite (820,400,'plataforma')
        plataforma1.setScale(0.27)
        plataforma1.body.setAllowGravity(false);
        plataforma1.body.setImmovable(true);
        plataforma1.body.setSize(400, 230);
        plataforma1.body.setOffset(120, 100);
    

        jugador = this.physics.add.sprite (40,100,'jugador')
        jugador.body.setSize(65, 80);
        jugador.body.setOffset(8, 10); // mueve la hitbox respecto al sprite 

        cursors = this.input.keyboard.createCursorKeys();
        var plataformas= this.physics.add.group();
        plataformas.createMultiple({
            key: 'plataforma',
            repeat: 5,
            setXY: {x:40,y:600,stepX: 200,stepY:-100 },
        });

        plataformas.children.iterate(function(child) {
            child.setScale(0.27, 0.27);
            child.body.setAllowGravity(false);
            child.body.setImmovable(true);
            child.body.setSize(400, 230);
            child.body.setOffset(120, 100);
            
        });


    

      
        this.physics.add.collider(jugador, plataformas);
        this.physics.add.collider(jugador, plataforma1);
        this.physics.add.collider(gato, plataforma1);
  
        
        this.physics.add.overlap(jugador, gato, this.victory, null, this);
    }

    update()  {
    if (cursors.left.isDown){
        jugador.setVelocityX(-200);
        jugador.setFlipX(true);
        estado = 'moviendose';
    } else if(cursors.right.isDown){
        jugador.setVelocityX(200);
        jugador.setFlipX(false); 
        estado = 'moviendose';
    } else {
        jugador.setVelocityX(0);
        estado = 'quieto';
    }
    if (cursors.up.isDown && jugador.body.touching.down){
        jugador.setVelocityY(-800);
        estado = 'saltando';
    }

    else if(jugador.y > 1000 || jugador.x<0 || jugador.x>1000){
        this.gameOver();
    }

    if (estado === 'quieto') {
        // Reproduce la animación de idle
         }   
    else if (estado === 'movviendose') {
        // Reproduce la animación de movimiento
         }
    else if (estado === 'saltando') {
        // Reproduce la animación de salto
         }    
    }

    gameOver(){
    this.physics.pause();
    let gameOverText = this.add.text(500, 300, 'Game Over', { fontSize: '32px', fill: '#FF0000' });
    gameOverText.setOrigin(0.5);

    // Detén el juego o haz lo que necesites hacer cuando el juego termine
    console.log("¡Game Over!");
    let botony=400;
    let botonReinicio = this.add.rectangle(500, botony, 150, 50, 0xFFFFFF).setInteractive();
    let textoBoton = this.add.text(500, botony, 'Reiniciar', { fontSize: '20px', fill: '#000000' }).setOrigin(0.5);

    botonReinicio.on('pointerdown', () => this.reiniciarJuego());
  

    }

    victory(){
    this.physics.pause();
    let victoryText = this.add.text(500, 300, '¡Victoria!', { fontSize: '32px', fill: '#00FF00' });
    victoryText.setOrigin(0.5);

    console.log("¡Victoria!");
    let botony=400;
    let botonReinicio = this.add.rectangle(500, botony, 150, 50, 0xFFFFFF).setInteractive();
    let textoBoton = this.add.text(500, botony, 'Reiniciar', { fontSize: '20px', fill: '#000000' }).setOrigin(0.5);

    botonReinicio.on('pointerdown', () => this.reiniciarJuego());
    }

    reiniciarJuego() {
    // Código para reiniciar el juego
    this.scene.restart();
    }

    
}

const config = {
    type: Phaser.AUTO,
    width: 1050,
    height: 600,
    scene: Example,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 1500 },
            
        }
    }
};



const game = new Phaser.Game(config);
    

        

    </script>

 </div>
   
    
</body>
</html>
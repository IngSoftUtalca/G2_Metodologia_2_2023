<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="tresenlinea.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body style="margin-right:19% ; margin-top:8%; display:flex;align-items: center">
    <div id="phaser-container"></div>
    <script>
        class Menu_modalidad extends Phaser.Scene {
            preload() {
                this.load.setBaseURL('https://labs.phaser.io%27/');
                this.load.image('sky', 'assets/skies/space3.png');
                this.load.image('logo', 'assets/sprites/phaser3-logo.png');
                this.load.image('red', 'assets/particles/red.png');
            }

            create() {
                var fondo = this.add.image(200, 300, 'sky');

                const particles = this.add.particles(0, 0, 'red', {
                    speed: 100,
                    scale: { start: 1, end: 0 },
                    blendMode: 'ADD'
                });

                const logo = this.physics.add.image(400, 100, 'logo');

                logo.setVelocity(100, 200);
                logo.setBounce(1, 1);
                logo.setCollideWorldBounds(true);

                particles.startFollow(logo);

                // botones
                var option1 = this.add.text(525, 250, 'Jugador vs Jugador', { fontSize: '32px', fill: '#fff' }).setOrigin(0.5).setInteractive({ useHandCursor: true })
                .setInteractive().on('pointerdown', () => this.scene.start('Escena_jvj'));

                var option2 = this.add.text(525, 350, 'Jugador vs Máquina', { fontSize: '32px', fill: '#fff' }).setOrigin(0.5).setInteractive({ useHandCursor: true });

                // pa que se puedan seleccionar
                

                option2.on('pointerup', function () {
                    console.log('Has seleccionado la Opción 2');
                    // Aca iria la pagina que abriria al clickear
                });
            }
        }


        class Escena_jvj extends Phaser.Scene{
            constructor() {
                super('Escena_jvj'); // 'Escena_jvj' es la clave única de esta escena
            }

            create(){
                this.cameras.main.setBackgroundColor('#608BA6'); //ajustar el color del fondo

                let graphics1 = this.add.graphics();
                graphics1.lineStyle(25, 0x5A6973); // grosor y color del borde de la ventana
                graphics1.strokeRect(0, 0, this.game.config.width, this.game.config.height); // Dibuja el borde

                this.crea_tablero(); // se dibuja el tablero de juego

                let texto = this.add.text(500, 150, 'Turno actual:', { font: '40px Arial', fill: '#5A6973', fontStyle: 'bold' });

                var self = this; // Guardar el contexto de 'this'

                //matriz bidimensional que representa el tablero de juego
                let tablero = [
                    [1,1,1],
                    [1,1,1],
                    [1,1,1]
                ]

                var contador = 0;
                var turnoX= true;
                let x;
                let y;
                self.input.on('pointerdown', function (pointer) {
                    if(contador < 9){
                        x = pointer.x;
                        y = pointer.y;
                        if(self.determina_fila(y)!=-1 && self.determina_columna(x)!=-1){ //Verifica que la posición en donde se hizo click esté dentro del tablero
                            x = self.centra_X(self.determina_columna(x));
                            y = self.centra_Y(self.determina_fila(y));
                            if(turnoX){
                                //Dibuja la cruz
                                var lienzo = self.add.graphics({ lineStyle: { width: 10, color: 0x5A6973 } });
                                self.dibuja_X(x,y,lienzo);

                                turnoX = false;
                            }
                            else{
                                //Dibujo el circulo
                                var figura = self.add.graphics({ lineStyle: { width: 10, color: 0x5A6973 } });
                                self.dibuja_O(x,y, figura);

                                turnoX = true;
                            }
                            contador++;
                        }    
                    }
                });

            }

            crea_tablero(){
                let linea1 = this.add.graphics().lineStyle(10, 0x5A6973);
                linea1.beginPath();
                linea1.moveTo(180, 100);
                linea1.lineTo(180, 500);
                linea1.closePath();
                linea1.strokePath();

                let linea2 = this.add.graphics().lineStyle(10, 0x5A6973);
                linea2.beginPath();
                linea2.moveTo(310, 100);
                linea2.lineTo(310, 500);
                linea2.closePath();
                linea2.strokePath();

                let linea3 = this.add.graphics().lineStyle(10, 0x5A6973);
                linea3.beginPath();
                linea3.moveTo(45, 235);
                linea3.lineTo(445, 235);
                linea3.closePath();
                linea3.strokePath();

                let linea4 = this.add.graphics().lineStyle(10, 0x5A6973);
                linea4.beginPath();
                linea4.moveTo(45, 365);
                linea4.lineTo(445, 365);
                linea4.closePath();
                linea4.strokePath();
            }

            dibuja_X(x,y,lienzo){
                var tamano = 40; // Tamaño de la "X"

                // Dibujar la primera línea de la "X"
                lienzo.beginPath();
                lienzo.moveTo(x - tamano, y - tamano);
                lienzo.lineTo(x + tamano, y + tamano);
                lienzo.strokePath();

                // Dibujar la segunda línea de la "X"
                lienzo.beginPath();
                lienzo.moveTo(x + tamano, y - tamano);
                lienzo.lineTo(x - tamano, y + tamano);
                lienzo.strokePath();

            }

            dibuja_O(x,y, figura){
                var circulo = new Phaser.Geom.Circle(x, y, 40); // Crear un círculo
                figura.strokeCircleShape(circulo); // Dibujar el círculo
            }

            determina_columna(x){
                if(x > 45 && x < 445  ){ //verifica si el valor del eje x está dentro de los límites del tablero
                    if(x < 180){
                        return 0;
                    }
                    else if(x<310){
                        return 1;
                    }
                    else if(x<445){
                        return 2;
                    }
                }else{
                    return -1;
                }
            }

            determina_fila(y){
                if(y > 100 && y < 500  ){ //verifica si el valor del eje y está dentro de los límites del tablero
                    if(y < 235){return 0;}
                    if(y < 365){return 1;}
                    if(y < 500){return 2;}
                }
                else{return -1;}                
            }

            centra_X(columna){
                if(columna == 0) {return 112.5;}
                if(columna == 1) {return 245;}
                if(columna == 2) {return 377.5;}
            }

            centra_Y(fila){
                if(fila == 0) {return 167.5;}
                if(fila == 1) {return 300;}
                if(fila == 2) {return 432.5;}
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: 1050,
            height: 600,
            scene: Escena_jvj,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 200 }
                }
            }
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>